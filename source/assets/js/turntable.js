!function(){var a=new Phaser.Game(360,540,Phaser.AUTO,"game");BasicGame={},BasicGame.Boot=function(){},BasicGame.Boot.prototype={init:function(){a.stage.backgroundColor=document.body.bgColor,this.input.maxPointers=1,this.scale.parentIsWindow=!0,this.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.scale.pageAlignHorizontally=!0,this.scale.pageAlignVertically=!0},preload:function(){this.load.image("preloaderBar","assets/preloader.png"),this.load.image("preloaderbar-bottom","assets/preloader-bottom.png")},create:function(){this.state.start("Preloader")}},BasicGame.Preloader=function(){this.preloadBar=null,this.ready=!1},BasicGame.Preloader.prototype={preload:function(){this.add.sprite(55,250,"preloaderbar-bottom"),this.preloadBar=this.add.sprite(58,257,"preloaderBar"),this.load.setPreloadSprite(this.preloadBar),this.load.image("turntable",turntableImage),this.load.image("panel","assets/turntable/panel.png"),this.load.image("lottery","assets/turntable/start-button1.png"),this.load.image("press","assets/turntable/press-button.png"),this.load.image("mid-pannel","assets/turntable/mid.png"),this.load.image("desc-header","assets/turntable/desc-header.png"),this.load.image("desc-body","assets/turntable/desc-body.png"),this.load.image("desc-footer","assets/turntable/desc-footer.png"),a.load.audio("sound-turn","assets/turntable/turn.mp3")},create:function(){this.preloadBar.cropEnabled=!1},update:function(){0==this.ready&&(this.ready=!0,this.state.start("Game"))}},BasicGame.Game=function(){this.add,this.camera,this.cache,this.input,this.load,this.math,this.sound,this.stage,this.time,this.tweens,this.world,this.particles,this.physics,this.rnd,this.ready=!0,this.award="",this.costText,this.pointsText,this.gameoverText,this.gameoverGroup,this.descobj,this.remainNum,this.scrollY=!1,this.enableScroll},BasicGame.Game.prototype={create:function(){var e,f,g,h,b=a.add.group(),c=this.cache.getImage("turntable");for(circleX=a.width/2,circleY=100+c.height/2,this.turntable=b.create(circleX,circleY,"turntable"),this.turntable.anchor.setTo(.5),b.create(circleX-92,circleY-123,"mid-pannel"),e=a.add.button(circleX,circleY,"lottery",this.lottery,this),e.anchor.setTo(.5),b.add(e),this.soundTurn=this.add.sound("sound-turn"),this.remainNum=0,isLogin?this.remainNum=freeNum-todayNum:!isLogin&&localStorage&&(f=(new Date).toLocaleDateString(),todayTimes=localStorage.getItem("todayTimes"),lastDay=localStorage.getItem("lastDay"),lastDay&&f==lastDay||(todayTimes=0),this.remainNum=freeNum-todayTimes),this.costText=a.add.text(a.world.centerX,circleY+65,"",{font:"16px Arial",fill:"#ffffff",align:"center"},b),this.costText.anchor.setTo(.5),this.showCost(),this.add.sprite(0,0,"panel"),this.add.text(a.world.centerX,10,"大转盘",{font:"30px Arial",fill:"#000000"}).anchor.setTo(.5,0),isLogin&&(this.pointsText=this.add.text(260,15,userpoints,{font:"20px Arial",fill:"#000000"})),desc=desc.replace(/###/g,"\n"),descText=a.add.text(22,482,desc,{font:"20px Arial",fill:"#000000"}),descY=450,a.add.sprite(10,descY,"desc-header"),descY+=31,i=1;i<=Math.ceil(descText.getLocalBounds().height/9);i++)a.add.sprite(10,descY,"desc-body"),descY+=9;a.add.sprite(10,descY,"desc-footer"),a.world.bringToTop(descText),descText.getLocalBounds().height>40?(g=500+descText.getLocalBounds().height,this.enableScroll=!0,a.world.setBounds(0,0,360,g),a.inputEnabled=!0,a.input.onDown.add(this.beginScroll,this)):this.enableScroll=!1,this.gameoverGroup=a.add.group(),this.gameoverGroup.visible=!1,h={font:"bold 25px Arial",fill:"#0000FF",align:"center"},this.gameoverText=a.add.text(a.world.centerX,85,"",h,this.gameoverGroup),this.gameoverText.anchor.setTo(.5)},update:function(){this.enableScroll&&a.input.activePointer.isDown&&(a.camera.y+=this.scrollY-a.input.activePointer.y,this.scrollY=a.input.activePointer.y)},beginScroll:function(){this.scrollY=a.input.activePointer.y},showCost:function(){this.remainNum>0?this.costText.setText("免费("+this.remainNum+") "):this.costText.setText("每次"+consumePoints+"积分")},lottery:function(){if(this.ready){this.gameoverGroup.visible=!1;var a=this;ajax({url:"/turntable/lottery",data:{},onSuccess:function(b){var c=JSON.parse(b);0==c.code?(a.award=c.data.award,a.turn(+c.data.angle)):ajaxError(c.code)}})}},turn:function(b){var c,d,e;if(isLogin)if(this.remainNum>0)this.remainNum--,this.showCost();else{if(userpoints-=consumePoints,0>userpoints)return sweetAlert("您的积分不够"),void 0;this.pointsText.setText(userpoints)}if(!isLogin&&localStorage){if(c=(new Date).toLocaleDateString(),todayTimes=localStorage.getItem("todayTimes"),lastDay=localStorage.getItem("lastDay"),lastDay&&c==lastDay||(todayTimes=0),todayTimes>=freeNum)return sweetAlert("请登录"),void 0;localStorage.setItem("todayTimes",++todayTimes),localStorage.setItem("lastDay",c),this.remainNum>0&&(this.remainNum--,this.showCost())}this.ready=!1,this.turntable.angle=0,d=this.rnd.integerInRange(3,8),b=360*d-b,e=a.add.tween(this.turntable).to({angle:b},3300,Phaser.Easing.Circular.Out,!0),e.onComplete.add(this.endlottery,this),this.soundTurn.play()},endlottery:function(){var a;this.ready=!0,a=""==this.award?"很遗憾，未中奖":"恭喜，中了"+this.award+"！",this.gameoverText.setText(a),this.gameoverGroup.visible=!0,this.soundTurn.stop()}},a.state.add("Boot",BasicGame.Boot),a.state.add("Preloader",BasicGame.Preloader),a.state.add("Game",BasicGame.Game),a.state.start("Boot")}();