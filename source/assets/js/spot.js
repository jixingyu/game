!function(){var a=new Phaser.Game(360,540,Phaser.AUTO,"game");BasicGame={},BasicGame.Boot=function(){},BasicGame.Boot.prototype={init:function(){a.stage.backgroundColor=document.body.bgColor,window.innerWidth?(winWidth=window.innerWidth,winHeight=window.innerHeight):document.body&&document.body.clientWidth?(winWidth=document.body.clientWidth,winHeight=document.body.clientHeight):document.documentElement&&document.documentElement.clientHeight&&document.documentElement.clientWidth&&(winHeight=document.documentElement.clientHeight,winWidth=document.documentElement.clientWidth),this.input.maxPointers=1,this.scale.parentIsWindow=!0,this.scale.scaleMode=winHeight/winWidth>1.3&&1.7>winHeight/winWidth?Phaser.ScaleManager.EXACT_FIT:Phaser.ScaleManager.SHOW_ALL,this.scale.pageAlignHorizontally=!0,this.scale.pageAlignVertically=!0},preload:function(){this.load.image("preloaderBar","assets/preloader.png"),this.load.image("preloaderbar-bottom","assets/preloader-bottom.png")},create:function(){this.state.start("Preloader")}},BasicGame.Preloader=function(){this.preloadBar=null,this.ready=!1},BasicGame.Preloader.prototype={preload:function(){this.add.sprite(55,250,"preloaderbar-bottom"),this.preloadBar=this.add.sprite(58,257,"preloaderBar"),this.load.setPreloadSprite(this.preloadBar),this.load.image("menu-header","assets/spot/menu-header.png"),this.load.image("menu-mid","assets/spot/menu-mid.png"),this.load.image("menu-footer","assets/spot/menu-footer.png"),this.load.image("start","assets/spot/start.png"),this.load.image("header","assets/spot/header.png"),this.load.image("mid","assets/spot/mid.png"),this.load.image("footer","assets/spot/footer.png"),this.load.image("prompt","assets/spot/prompt.png"),this.load.image("prompt-times","assets/spot/prompt-times.png"),this.load.image("add-time","assets/spot/add-time.png"),this.load.image("next","assets/spot/next.png"),this.load.image("gamepoints","assets/gamepoints.png"),this.load.audio("sound-bg","assets/spot/bg.mp3"),this.load.json("sconfig","/spot/config")},create:function(){this.preloadBar.cropEnabled=!1,this.state.start("MainMenu")}},BasicGame.MainMenu=function(){this.music=null,this.playButton=null,this.scrollY,this.enableScroll,this.soundBg=null},BasicGame.MainMenu.prototype={create:function(){var b,c,d;if(this.add.sprite(0,0,"menu-header"),b=this.add.group(),b.create(0,120,"gamepoints"),this.pointsText=this.add.text(45,120,userpoints,{font:"20px Arial",fill:"#ffffff"},b),b.x=(a.world.width-b.width)/2,c=this.cache.getJSON("sconfig").data.desc,descText=a.add.text(40,205,c,{font:"20px Arial",fill:"#000000"}),d=0,descY=270,descText.getLocalBounds().height<=135)a.add.sprite(0,descY,"menu-mid"),descY+=62,this.enableScroll=!1;else for(this.enableScroll=!0,i=1;i<=Math.ceil((descText.getLocalBounds().height-135)/62);i++)a.add.sprite(0,descY,"menu-mid"),descY+=62,d++;a.add.sprite(0,descY,"menu-footer"),a.world.bringToTop(descText),this.enableScroll&&(a.world.setBounds(0,0,360,478+62*d),a.inputEnabled=!0,a.input.onDown.add(this.beginScroll,this)),this.add.button(a.world.centerX,descY+100,"start",this.startGame,this).anchor.setTo(.5,0),this.soundBg||(this.soundBg=this.add.sound("sound-bg",1,!0),this.soundBg.play())},update:function(){this.enableScroll&&a.input.activePointer.isDown&&(a.camera.y+=this.scrollY-a.input.activePointer.y,this.scrollY=a.input.activePointer.y)},beginScroll:function(){this.scrollY=a.input.activePointer.y},startGame:function(){this.state.start("Game",!0,!1)}},BasicGame.Game=function(){this.simages,this.circles,this.found=0,this.currentLevel,this.levelText,this.upImage,this.downImage,this.myLoader,this.currentImage,this.defaultRadius=20,this.timeText,this.remainTimer,this.remainTime,this.promptTimes,this.promptText,this.addtTimes,this.nextText=null,this.ready=!1,this.currentId,this.sconfig},BasicGame.Game.prototype={preload:function(){this.load.json("simages","/spot/images",!0)},init:function(){this.currentLevel=0,this.promptTimes=0,this.addtTimes=0,this.currentId=0,this.ready=!1,this.promptIng=!1,this.addTimeIng=!1,this.nextText=null,this.sconfig=this.cache.getJSON("sconfig"),this.sconfig=this.sconfig.data,this.remainTime=parseInt(this.sconfig.i),this.sconfig.fr=parseInt(this.sconfig.fr),this.sconfig.rp=parseInt(this.sconfig.rp),this.sconfig.mr=parseInt(this.sconfig.mr),this.sconfig.at=parseInt(this.sconfig.at),this.sconfig.st=parseInt(this.sconfig.st),this.sconfig.t=parseInt(this.sconfig.t),this.sconfig.tp=parseInt(this.sconfig.tp),this.sconfig.mt=parseInt(this.sconfig.mt)},create:function(){return this.simages=this.cache.getJSON("simages").data,!this.simages||this.simages.length<=0?(sweetAlert("请检查网络"),this.state.start("MainMenu"),void 0):(this.totalLevel=this.simages.length,this.myLoader=new Phaser.Loader(a),this.add.sprite(0,0,"header"),this.add.sprite(0,255,"mid"),this.add.sprite(0,485,"footer"),this.add.button(13,500,"prompt",this.promptOnce,this),this.promtTextBg=this.add.sprite(46,503,"prompt-times"),this.add.button(90,500,"add-time",this.addTime,this),this.promptText=this.add.text(57,517,this.sconfig.fr,{font:"15px Arial",fill:"#ffffff"}),this.promptText.anchor.setTo(.5),this.add.text(133,517,"$",{font:"18px Arial",fill:"#ffffff"}).anchor.setTo(.5),this.levelText=this.add.text(305,22,"",{font:"28px Arial",fill:"#ffffff"}),this.levelText.anchor.setTo(.5),this.add.text(a.world.centerX,150,"加载中...",{font:"25px Arial",fill:"#ffffff"}).anchor.setTo(.5),this.add.text(a.world.centerX,380,"加载中...",{font:"25px Arial",fill:"#ffffff"}).anchor.setTo(.5),this.circles=a.add.graphics(0,0),this.nextLevel(),void 0)},nextLevel:function(){this.found=0,this.ready=!1,this.simages.length<=0?a.time.events.add(Phaser.Timer.SECOND,function(){var a=this;sweetAlert({title:"恭喜通关！"},function(){a.state.start("MainMenu")})},this).autoDestroy=!0:this.currentLevel>0?(this.nextText?(this.nextText.scale.set(0),this.nextText.visible=!0,a.world.bringToTop(this.nextText)):(this.nextText=this.add.sprite(a.world.centerX,a.world.centerY,"next"),this.nextText.anchor.setTo(.5),this.nextText.scale.set(0)),a.add.tween(this.nextText.scale).to({x:2,y:2},1e3,Phaser.Easing.Sinusoidal.Out,!0).onComplete.add(function(){this.goNext()},this)):this.goNext()},goNext:function(){for(this.currentLevel++,this.levelText.setText(this.totalLevel+" - "+this.currentLevel),this.currentImage=this.simages.pop(),this.currentImage.coordinate=JSON.parse(this.currentImage.coordinate),i=0;i<this.currentImage.coordinate.length;i++)this.currentImage.coordinate[i].x=parseInt(this.currentImage.coordinate[i].x),this.currentImage.coordinate[i].y=parseInt(this.currentImage.coordinate[i].y),this.currentImage.coordinate[i].iradius=parseInt(this.currentImage.coordinate[i].r)>0?this.currentImage.coordinate[i].r:this.defaultRadius;this.myLoader.image("up","assets/spot/images/"+this.currentImage.image_ori,!0),this.myLoader.image("down","assets/spot/images/"+this.currentImage.image_mod,!0),1==this.currentLevel?(this.myLoader.onLoadComplete.addOnce(this.firstLoaded,this),this.myLoader.start()):(this.myLoader.onLoadComplete.addOnce(this.imageLoaded,this),this.myLoader.start())},firstLoaded:function(){var a=this;ajax({url:"/spot/begin",data:{},onSuccess:function(b){var c=JSON.parse(b);0==c.code?(a.currentId=c.data.i,a.ready=!0,a.begin()):ajaxError(c.code)}})},begin:function(){this.upImage=this.add.sprite(0,44,"up"),this.downImage=this.add.sprite(0,274,"down"),this.upImage.inputEnabled=!0,this.upImage.events.onInputDown.add(this.check,this),this.downImage.inputEnabled=!0,this.downImage.events.onInputDown.add(this.check,this),this.circles.lineStyle(3,16711680),a.world.bringToTop(this.circles),this.timeText=this.add.text(300,503,this.getRTime(),{font:"21px Arial",fill:"#ffffff"}),this.remainTimer=a.time.events.loop(Phaser.Timer.SECOND,this.updateTime,this)},imageLoaded:function(){this.nextText.visible=!1,this.upImage.loadTexture("up"),this.downImage.loadTexture("down"),this.circles.clear(),this.circles.lineStyle(3,16711680),this.ready=!0},finishOne:function(){var a=this;ajax({url:"/spot/finish",data:{i:this.currentId,level:this.currentLevel},onSuccess:function(b){var c=JSON.parse(b);0==c.code?(c.data&&c.data.points&&(userpoints+=parseInt(c.data.points),a.showPoints("+"+c.data.points,"#01A04C")),a.nextLevel()):ajaxError(c.code)}})},showPoints:function(b,c){var d,e;c=c||"#E90B0C",d="#E90B0C"==c?this.add.text(a.world.centerX,180,b,{font:"bold 30px Arial",fill:c}):this.add.text(100,180,b,{font:"bold 30px Arial",fill:c}),d.anchor.setTo(.5),e=a.add.tween(d).to({y:80},1e3,Phaser.Easing.Linear.None),e.to({alpha:0,y:30},500,Phaser.Easing.Linear.None),e.onComplete.add(function(){d.destroy()}),e.start()},updateTime:function(){var b,c;this.ready&&(this.remainTime--,this.remainTime<=0?(a.time.events.remove(this.remainTimer),this.timeText.setText("00:00"),this.ready=!1,b=!1,c=this,sweetAlert({title:"时间到！"},function(){b=!0,c.state.start("MainMenu")}),a.time.events.add(5*Phaser.Timer.SECOND,function(){b||this.state.start("MainMenu")},this).autoDestroy=!0):this.timeText.setText(this.getRTime()))},getRTime:function(){return minutes=Math.floor(this.remainTime/60),seconds=this.remainTime%60,10>minutes&&(minutes="0"+minutes),10>seconds&&(seconds="0"+seconds),minutes+":"+seconds},check:function(a,b){for(i=0;i<this.currentImage.coordinate.length;i++)if(this.math.distance(b.x,b.y,this.currentImage.coordinate[i].x,this.currentImage.coordinate[i].y+44)<this.currentImage.coordinate[i].iradius||this.math.distance(b.x,b.y,this.currentImage.coordinate[i].x,this.currentImage.coordinate[i].y+274)<this.currentImage.coordinate[i].iradius)return this.circles.drawCircle(this.currentImage.coordinate[i].x,44+this.currentImage.coordinate[i].y,2*this.currentImage.coordinate[i].iradius),this.circles.drawCircle(this.currentImage.coordinate[i].x,274+this.currentImage.coordinate[i].y,2*this.currentImage.coordinate[i].iradius),this.found++,this.currentImage.coordinate.splice(i,1),this.remainTime+=this.sconfig.at,5==this.found&&this.finishOne(),void 0;this.remainTime-=this.sconfig.st},promptOnce:function(){var a,b;if(!(!this.ready||this.promptIng||this.found>=5))if(this.promptTimes>=this.sconfig.fr+this.sconfig.mr)sweetAlert("每轮最多购买"+this.sconfig.mr+"次提醒");else if(this.promptTimes>=this.sconfig.fr){if(userpoints<this.sconfig.rp)return sweetAlert("您的积分不够"),void 0;this.promptIng=!0,a=this,ajax({url:"/spot/prompt",data:{i:this.currentId},onSuccess:function(b){var c=JSON.parse(b);0==c.code?(userpoints-=a.sconfig.rp,a.showPoints("-"+a.sconfig.rp),a.doPrompt()):ajaxError(c.code)},onComplete:function(){a.promptIng=!1}})}else b=this.sconfig.fr-this.promptTimes-1,0>=b&&(this.promtTextBg.destroy(),b="$",this.promptText.setStyle({font:"18px Arial",fill:"#ffffff"})),this.promptText.setText(b),this.doPrompt()},doPrompt:function(){this.promptTimes++,promptpoint=this.currentImage.coordinate.pop(),this.circles.drawCircle(promptpoint.x,44+promptpoint.y,2*promptpoint.iradius),this.circles.drawCircle(promptpoint.x,274+promptpoint.y,2*promptpoint.iradius),this.found++,5==this.found&&this.finishOne()},addTime:function(){if(this.ready&&!this.addTimeIng)if(this.addtTimes>=this.sconfig.mt)sweetAlert("每轮最多加时"+this.sconfig.mt+"次");else{if(userpoints<this.sconfig.t)return sweetAlert("您的积分不够"),void 0;this.addTimeIng=!0;var a=this;ajax({url:"/spot/timer",data:{i:this.currentId},onSuccess:function(b){var c=JSON.parse(b);0==c.code?(userpoints-=a.sconfig.tp,a.remainTime+=a.sconfig.t,a.showPoints("-"+a.sconfig.tp),a.addtTimes++):ajaxError(c.code)},onComplete:function(){a.addTimeIng=!1}})}},update:function(){}},a.state.add("Boot",BasicGame.Boot),a.state.add("Preloader",BasicGame.Preloader),a.state.add("MainMenu",BasicGame.MainMenu),a.state.add("Game",BasicGame.Game),a.state.start("Boot")}();